<nav id="sideNav">
  <% unless admin? %>
    <dl class="shop">
      <dt>
        <a href="#"><%= shop.name %>の設定</a>
      </dt>
    </dl>
  <% end %>

  <% if can? :manage, GoogleContact %>
    <dl>
      <%= active_link_to settings_user_contact_groups_path(super_user), active: [["settings/contact_groups", "settings/ranks"]], wrap_tag: :dt, class_active: "here" do %>
        <span><i class="fa fa-users fa-2x"></i>&nbsp;<%= t("settings.contact.info_title") %></span>
      <% end %>
    </dl>
  <% end %>


  <%
      # because settings_user_working_time_staffs_path are available in two group, so need to know which group menu users stay
      if is_active_link?(request.original_fullpath, [["settings/working_time/staffs"]])
        working_time_under_shop_menu = Rails.application.routes.recognize_path(request.referrer || "")[:controller] != "settings/staffs"
      end
  %>
  <% if can? :manage, Settings %>
    <dl class="shop">
      <%= active_link_to content_tag(:span, "<i class='fa fa-calendar fa-2x'></i>&nbsp;予約管理".html_safe), can?(:create, Shop) ? settings_user_shops_path(super_user) : settings_user_business_schedules_path(super_user),
        active: [["settings/shops", "settings/business_schedules", "settings/reservation_settings", working_time_under_shop_menu && "settings/working_time/staffs"]],
        wrap_tag: :dt,
        class_active: "here" %>
      <dd>
        <ul>
          <% if can? :create, Shop %>
            <%= active_link_to t("settings.shop.info_title"), settings_user_shops_path(super_user), active: [["settings/shops"], []], wrap_tag: :li, class_active: "here" %>
          <% end %>

          <%= active_link_to t("settings.business_hours.info_title"), settings_user_business_schedules_path(super_user), active: [["settings/business_schedules"], []], wrap_tag: :li, class_active: "here" %>
          <%= active_link_to t("settings.staff.work_time"), settings_user_working_time_staffs_path(super_user, mode: "working_schedules"),
            active: /working_schedules/,
            wrap_tag: :li,
            class_active: "here" %>
          <%= active_link_to "予約枠", settings_user_reservation_settings_path(super_user), active: [["settings/reservation_settings"], []], wrap_tag: :li, class_active: "here" %>
        </ul>
      </dd>
    </dl>
  <% end %>

  <% if can? :manage, Settings %>
    <dl class="menu">
      <%= active_link_to content_tag(:span, t("settings.menu.info_title")), settings_user_menus_path(super_user),
        active: [["settings/menus", "settings/categories"]],
        wrap_tag: :dt,
        class_active: "here" %>
      <dd>
        <ul>
          <%= active_link_to t("settings.menu.info_title"), settings_user_menus_path(super_user),
            active: [["settings/menus"]],
            wrap_tag: :li,
            class_active: "here" %>
          <%= active_link_to t("settings.category.info_title"), settings_user_categories_path(super_user),
            active: [["settings/categories"]],
            wrap_tag: :li,
            class_active: "here" %>
        </ul>
      </dd>
    </dl>
  <% end %>

  <dl class="staff">
    <%= active_link_to content_tag(:span, t("settings.staff.sider_label")), can?(:manage, Settings) ? settings_user_staffs_path(super_user) : edit_settings_user_staff_path(super_user, staff),
      active: [["settings/staffs", !working_time_under_shop_menu && "settings/working_time/staffs"]],
      wrap_tag: :dt,
      class_active: "here" %>
    <dd>
      <ul>
        <% if can? :manage, Settings %>
          <%= active_link_to t("settings.staff.info_title"), settings_user_staffs_path(super_user),
            active: [["settings/staffs"]],
            wrap_tag: :li,
            class_active: "here" %>

          <%= active_link_to t("settings.staff.work_time"), settings_user_working_time_staffs_path(super_user, mode: "working_schedules"),
            active: /working_schedules/,
            wrap_tag: :li,
            class_active: "here" %>
        <% else %>
          <%= active_link_to t("settings.staff.info_title"),
            edit_settings_user_staff_path(super_user, staff),
            active: [["settings/staffs"]],
            wrap_tag: :li,
            class_active: "here" %>

          <%#
            full time permission or
            (
              part time worker and has regular/temporary working time permission
            )

            # full time worker but don't have full time permission only have regular/temporary permission would be ignored.
          %>
          <% if can?(:manage_staff_full_time_permission, shop_staff) ||
            (
              !staff.business_schedules.full_time.where(shop: shop).exists? && (
                can?(:manage_staff_regular_working_day_permission, shop_staff) ||
                can?(:manage_staff_temporary_working_day_permission, shop_staff)
              )
            )
          %>
            <%= active_link_to t("settings.staff.work_time"), working_schedules_settings_user_working_time_staff_path(super_user, staff),
              active: /working_schedules/,
              wrap_tag: :li,
              class_active: "here" %>
          <% end %>
        <% end %>

      </ul>
    </dd>
  </dl>

  <% if current_user == super_user %>
    <dl>
      <%= active_link_to settings_user_profile_path(current_user), active: [["settings/profiles", "settings/payments", "settings/plans"]], wrap_tag: :dt, class_active: "here" do %>
        <span><i class="fa fa-wrench fa-2x"></i>&nbsp;<%= t("settings.account.info_title") %></span>
      <% end %>
      <dd>
        <ul>
          <%= active_link_to settings_user_profile_path(current_user),
            active: [["settings/profiles"]], wrap_tag: :li, class_active: "here" do %>
            <span><%= t("settings.account.info_title2") %></span>
          <% end %>

          <%= active_link_to settings_payments_path,
            active: [["settings/payments", "settings/plans"]], wrap_tag: :li, class_active: "here" do %>
            <span><%= t("settings.plans.info_title") %></span>
          <% end %>
        </ul>
      </dd>
    </dl>
  <% end %>
</nav>
