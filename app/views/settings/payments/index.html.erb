<div id="subNav">
  <h2><%= t("settings.account.info_title") %> − <%= t("settings.plans.info_title1") %></h2>
</div>
<div id="about">
  <p><%= t("settings.plans.info_1") %><br /><%= t("settings.plans.info_2") %></p>
</div>

<div class="payments">
  <table class="subscription">
    <caption><%= t("settings.plans.plan_info.caption") %></caption>
    <tbody>
      <tr>
        <th><%= t("settings.plans.plan_info.current_plan") %></th>
        <td>
          <%= t("settings.plans.plan_info.plan_member", plan_name: current_user.member_plan_name) %>
          <%= link_to t("settings.plans.plan_info.change_plan"), settings_plans_path, class: "btn btn-yellow" %>
        </td>
      </tr>
      <tr>
        <th><%= t("settings.plans.plan_info.join_date") %></th>
        <td><%= l(current_user.created_at.to_date) %></td>
      </tr>
      <tr>
        <th><%= t("settings.plans.plan_info.status") %></th>
        <td><%= subscription_status(@subscription) %></td>
      </tr>
      <tr>
        <th><%= t("settings.plans.plan_info.next_billing_date") %></th>
        <td>
          <% if current_user.trial_member? %>
            <%= l(current_user.trial_expired_date) %>
          <% else %>
            <%= @subscription.expired_date && l(@subscription.expired_date) if @subscription.active? && @subscription.charge_required %>
            <%= " (#{@subscription.next_plan.name}変更予定)" if @subscription.active? && @subscription.next_plan %>
          <% end %>
        </td>
      </tr>
    </tbody>
  </table>

  <table class="history">
    <caption><%= t("settings.plans.info_title1") %></caption>
    <thead>
      <tr>
        <th class="charge-date"><%= t("settings.plans.payment.date") %></th>
        <th class="charge-amount"><%= t("settings.plans.payment.amount") %></th>
        <th class="charge-plan"><%= t("settings.plans.payment.plan") %></th>
        <th class="charge-receipt"><%= t("settings.plans.payment.receipt") %></th>
      </tr>
    </thead>
    <tbody>
      <% @charges.each do |charge| %>
      <tr>
        <td><%= l(charge.created_at.to_date) %></td>
        <td><%= charge.amount.format %></td>
        <td><%= charge_description(charge) %> <%= "(#{t("settings.plans.payment.refund")})" if charge.refunded? %></td>
        <td>
          <%= link_to t("settings.plans.payment.receipt_link"), receipt_settings_payment_path(charge, format: :pdf), target: "_blank" %>
          <%= link_to t("settings.plans.payment.refund"), "#", class: "btn btn-orange", data: { toggle: "modal", target: "#refund-modal" } if @refundable && @subscription.first_charge.id == charge.id %>
        </td>
      </tr>
      <% end %>
    </tbody>
  </table>

  <% if @refundable %>
    <div class="modal fade" id="refund-modal" tabIndex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content refund-area">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">×</span>
            </button>
            <h4 class="modal-title">
              <%= t("settings.plans.refund.modal_title") %>
            </h4>
          </div>
          <div class="modal-body">
            <div>
              <%= t("settings.plans.refund.desc") %>
            </div>
            <div class="refund-label">
              <%= t("settings.plans.refund.label1") %>
            </div>
            <div>
              <%= t("settings.plans.refund.desc1") %>
            </div>
            <div class="refund-label">
              <%= t("settings.plans.refund.label2") %>
            </div>
            <div>
              <%= t("settings.plans.refund.desc1") %>
            </div>
          </div>
          <div class="modal-footer">
            <%= link_to t("settings.plans.refund.cancel_btn"), '#', class: "btn btn-tarco", data: { dismiss: "modal" } %>
            <%= link_to t("settings.plans.refund.confirm_btn"), refund_settings_payments_path, class: "btn btn-orange" %>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>
