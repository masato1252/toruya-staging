<div class="service-show form with-top-bar">
  <%= render "lines/user_bot/top_navigation_bar",
    previous_path: params[:from] == "customer_dashboard" ? lines_user_bot_customers_path(customer_id: @customer.id, target_view: Customer::DASHBOARD_TARGET_VIEWS[:reservations]) : lines_user_bot_service_customers_path(service_id: @online_service.id),
    title: t("user_bot.dashboards.settings.service_customer_relation.service_register")
  %>

  <div class="field-group-header" id="name"><%= t("user_bot.dashboards.settings.service_customer_relation.register") %></div>
  <div class="field-header" id="name"><%= t("common.customer_name") %></div>
  <%= render "lines/user_bot/field_row", title: @customer.name %>

  <div class="field-header" id="name"><%= t("user_bot.dashboards.settings.service_customer_relation.permission_state") %></div>
  <div class="flex">
    <span class="state <%= @relation.state %>"></span>
    <%= render "lines/user_bot/field_row", title: t("user_bot.dashboards.settings.service_customer_relation.permission_states.#{@relation.state}") %>
  </div>

  <div class="field-header" id="name"><%= t("user_bot.dashboards.settings.service_customer_relation.signup_date") %></div>
  <%= render "lines/user_bot/field_row", title: I18n.l(@relation.created_at, format: :long_date_with_wday) %>

  <div class="field-header" id="name"><%= t("user_bot.dashboards.settings.service_customer_relation.expire_date") %></div>
  <%= render "lines/user_bot/field_row", title: @relation.expire_at ? I18n.l(@relation.expire_at, format: :long_date_with_wday) : I18n.t("sales.never_expire") %>

  <div class="field-header" id="name"><%= t("user_bot.dashboards.settings.service_customer_relation.payment_plan") %></div>
  <%= render "lines/user_bot/field_row" do %>
    <span><%= @relation.selling_prices_text %></span>
    <%= link_to "Change Card", "#", class: "btn btn-yellow" unless @is_owner %>
  <% end %>

  <div class="field-header" id="name"><%= t("user_bot.dashboards.settings.service_customer_relation.payment_state") %></div>
  <% @relation.customer_payments.order("id DESC").each do |payment| %>
    <div class="flex">
      <span class="state <%= payment.state %>"></span>
      <%= render "lines/user_bot/field_row" do  %>
        <span>
          <%= t("user_bot.dashboards.settings.service_customer_relation.customer_payment_states.#{payment.state}") %>
          <%= I18n.l(payment.charge_at) %>
        </span>
        <%= link_to "Pay", new_customer_payments_path(encrypted_social_service_user_id: params[:encrypted_social_service_user_id], order_id: payment.order_id), class: "btn btn-yellow" unless @is_owner || payment.completed? %>
      <% end %>
    </div>
  <% end %>

  <% if @online_service.external? && @relation.available? && @relation.current %>
    <%= render "lines/user_bot/bottom_navigation_bar", klass: "transparent" do %>
      <%= link_to stop_lines_user_bot_service_customer_path(@online_service, @relation),
        method: :delete,
        data: { confirm: t("user_bot.dashboards.settings.service_customer_relation.stop_usage_confirmation") },
        class: "btn btn-yellow btn-circle btn-save btn-tweak btn-with-word" do %>
        <i class="fas fa-ban fa-2x"></i>
        <div class="word"><%= I18n.t("action.stop_usage") %></div>
      <% end %>
    <% end %>
  <% end %>

  <% if @online_service.external? && @relation.pending_payment_state? && @relation.current %>
    <%= render "lines/user_bot/bottom_navigation_bar", klass: "transparent" do %>
      <%= link_to cancel_lines_user_bot_service_customer_path(@online_service, @relation),
        method: :delete,
        data: { confirm: t("user_bot.dashboards.settings.service_customer_relation.cancel_confirmation") },
        class: "btn btn-orange btn-circle btn-tweak btn-bottom-left" do %>
        <i class="fas fa-trash fa-2x"></i>
      <% end %>
      <span></span>
      <%= link_to approve_lines_user_bot_service_customer_path(@online_service, @relation), method: :post, class: "btn btn-yellow btn-circle btn-save btn-tweak btn-with-word" do %>
        <i class="fas fa-user-check fa-2x"></i>
        <div class="word"><%= I18n.t("action.approve") %></div>
      <% end %>
    <% end %>
  <% end %>
</div>
