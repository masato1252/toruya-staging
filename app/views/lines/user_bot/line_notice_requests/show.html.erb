<div class="container" style="padding-bottom: 60px;">
  <div class="row">
    <div class="col-md-8 col-md-offset-2">
      <div class="panel panel-default" style="border-radius: 8px; border: none;">
        <div class="panel-heading" style="padding: 20px 30px; border-radius: 8px 8px 0 0;">
          <h3 class="panel-title" style="font-size: 20px; font-weight: bold; margin: 0;"><%= t('line_notice_requests.store.show.title') %></h3>
        </div>
        <div class="panel-body" style="padding: 30px;">
          <!-- 予約情報 -->
          <div style="margin-bottom: 30px;">
            <h4 style="margin-bottom: 20px; color: #333; font-weight: bold;"><%= t('common.reservation_details') %></h4>
            <table class="table table-bordered" style="background-color: #fff;">
              <tbody>
                <tr>
                  <th style="width: 35%; background-color: #f9f9f9;"><%= t('common.customer_name') %></th>
                  <td><%= @customer.name %></td>
                </tr>
                <tr>
                  <th style="background-color: #f9f9f9;"><%= t('common.reservation_datetime') %></th>
                  <td><%= l(@reservation.start_time, format: :reservation_datetime) %></td>
                </tr>
                <tr>
                  <th style="background-color: #f9f9f9;"><%= t('common.menu') %></th>
                  <td><%= @reservation.menus_sentence %></td>
                </tr>
              </tbody>
            </table>
          </div>

          <hr style="margin: 30px 0; border-color: #e0e0e0;">

          <!-- 料金案内 -->
          <div style="margin-bottom: 35px;">
            <h4 style="margin-bottom: 20px; color: #333; font-weight: bold;"><%= t('line_notice_requests.store.show.charge_information') %></h4>
            <ul style="list-style: disc; padding-left: 20px; margin: 0;">
              <li>初回：無料</li>
              <li>２回目以降：１予約250円＋税</li>
            </ul>
          </div>

          <hr style="margin: 30px 0; border-color: #e0e0e0;">

          <!-- 承認ボタン -->
          <div style="display: flex; justify-content: center; padding-top: 10px;">
            <% if @is_free_trial %>
              <%= form_with(
                url: approve_lines_user_bot_line_notice_request_path(business_owner_id: business_owner_id, id: @line_notice_request.id),
                method: :post,
                local: true
              ) do |f| %>
                <%= f.submit "無料でリクエストを承認する",
                    class: 'btn btn-yellow btn-lg',
                    style: 'padding: 12px 40px; font-size: 18px; border-radius: 6px;',
                    data: { confirm: t('line_notice_requests.store.show.approve_confirm') } %>
              <% end %>
            <% else %>
              <button id="approve-with-payment-btn" class="btn btn-yellow btn-lg" style="padding: 12px 40px; font-size: 18px; border-radius: 6px;">
                料金を支払って承認する
              </button>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<% unless @is_free_trial %>
  <%= react_component("line_notice_requests/payment_modal", {
    props: {
      lineNoticeRequestId: @line_notice_request.id,
      businessOwnerId: business_owner_id,
      chargeAmount: @charge_amount,
      stripeKey: Rails.application.secrets.stripe_publishable_key,
      approveUrl: approve_lines_user_bot_line_notice_request_path(business_owner_id: business_owner_id, id: @line_notice_request.id),
      i18n: {
        modalTitle: t('line_notice_requests.store.payment.modal_title'),
        chargeAmountLabel: t('line_notice_requests.store.payment.charge_amount_label'),
        cardNumberLabel: t('line_notice_requests.store.payment.card_number_label'),
        submitButton: t('line_notice_requests.store.payment.submit_button'),
        cancelButton: t('common.cancel'),
        processing: t('common.processing')
      }
    }
  }) %>
<% end %>

<script>
  <% unless @is_free_trial %>
    document.addEventListener('DOMContentLoaded', function() {
      var approveBtn = document.getElementById('approve-with-payment-btn');
      if (approveBtn) {
        approveBtn.addEventListener('click', function() {
          window.dispatchEvent(new CustomEvent('openLineNoticePaymentModal'));
        });
      }
    });
  <% end %>
</script>
